# 12장 웹 소켓으로 실시간 데이터 전송하기

## 웹 소켓 이해하기

- 웹 소켓: HTML5에 새로 추가된 스펙. 실시간으로 데이터를 주고받기 위한 기술이며, WS라는 프로토콜을 사용함. 웹 소켓이 연결되면 업데이트가 있는지 따로 요청할 필요 없음.
- 웹 소켓과 HTTP는 같은 포트를 사용할 수 있음. 따로 포트 설정할 필요 x
- 서버센트 이벤트(Server sent events, sse): 서버가 클라이언트에게 데이터를 보낼 수 있는 단방향 통신 (주식 차트 업데이트 이런 건 서버가 일방적으로 보내주기만 해도 충분)
- Socket.IO: 웹 소켓을 편리하게 사용할 수 있게 도와주는 라이브러리

## ws 모듈로 웹 소켓 사용하기
```
// ws 모듈 설치하기
$ npm i ws@8
```
- require 구문으로 ws 모듈을 불러온 후 익스프레스 서버를 웹 소켓 서버(wss)와 연결함. 
- 연결 이후 wss에 이벤트 리스너를 붙임. 웹 소켓은 이벤트 기반으로 작동하며, 실시간으로 데이터를 전달받기 때문에 항상 대기하고 있어야 함. 
- message, error, close(이벤트 리스너들)
- setInterval: 3초마다 연결된 모든 클라이언트에 메세지를 보냄.
- 먼저 readyState이 OPEN인지 확인하여야 함.
- 웹 소켓 상태: CONNECTING, OPEN, CLOSING, CLOSED. OPEN일 때만 에러 없이 메세지를 보낼 수 있음. 
- close 이벤트에서 set.. 을 clearInterval로 바꿔야 메모리 누수가 발생하지 않음.
- 웹 소켓은 양방향 통신이기 때문에 서버 뿐만 아니라 클라이언트에서도 이용해야 함.

## Socket.IO 사용하기

```
$ npm i socket.io@4
```
- app.set('io', io)로 소켓 객체를 익스프레스와 연결, req.app.get('io')로 로 라우터에서 소켓 객체를 가져옴.
